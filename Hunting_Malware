*srvcp.exe
malware goals?

1 - md5sum

2 - obfuscated or packed?
toolkit=PEid "IDs of pE files)
drag & drop srvcp into PEid

LCC Win32.1x -> Jacob Navia[Overlay]
(lightweight C Compiler)
- This means it's compiled, not packed.

3 - BinText (look at strings)
drag & drop
Text fields:
scroll down relevant stuff--look for "significant strings" (.exes. IPs, URLs, Reg, email, any insight into funxality)
- srvcp.exe
- service profiler
- ftp -s:c:\flog
- remserver
- servers
- FTP get
- GET stuff
- *** IRCNAME ***
- NICK %c
- ping pong
- *** partial reg key (missing Hive) SOFTWARE\Microsoft (HKLM & HKU) ***
- printf
- scanf
~ halfway through, the strings repeat...
--------------------------------------------------- ^^^ static analysis ^^^
--------------------------------------------------  --- dynamic analysis ---
3 - Let's prepare tools for more analysis
Process Explorer: 	all running processes & dlls & handles in REAL TIME
Process Monitor:	captures events for us (10's of thousands).  - filter things to what we want later
cmd line tool:  "capturebat" #> capturebat > cap.txt
Remnux VM -- Wireshark

4 - now we can run malware & look at tools
(give 20/30 seconds to run before looking at tools)
4.1 - proc explorer:
capturebat.exe - dbl click --> (find path)
- strings tab -. image-> memory **(if it was encrypted/obfuscated)
- tcp/ip tab - uncheck resolve addresses.  Local Address (opened port)
	- KILL THAT PROCESS
4.2 CaptureBat:
- stop capturing
- find txt file
- above the dashed line is just capture bat talking (hopefully no errors!)
- below dashed line (good stuff) :
- 1st column = category (process/registry)
- 2nd column = responsible parent (explorer.exe)
- last column = result= instructor/demo/srvcp.exe
4.3 ProcMon:
- filter first column ... process name is srvcp.exe (focus on malware)
- Did it create or delete any files?
- (nothing found in capturebat)...
	- operation is createfile (all found in srvcp.exe)
		-> event properties:  look at Event - OpenResult:  (opened) means it was opened -- NOT CREATED.
		- dll -- create file ... created portion at bottom (NOT FOUND). so it looked for it, but not did create.
	- operation is regsetvalue
		- evidence from earlier (service profiler)
	- tools (process tree)
4.4 GUI tool in sysinternals:  AUTORUNs:
- HKLM\SOFTWARE:  (service profiler)
- use binoculars; search for strings and stuff.
- links to REGEDIT
	- service profiler 
5- NETWORK ACTIVITY:
- WIRESHARK  - DNS query, icmp, same stuff repeats over and over.  
	- it's really trying to get to that IRC server
	- how to tell malware to go to my remnux?  (probably added an entry in /etc/hosts)
	- ADD DNS ENTRY
* re-run the malware *
- now we see a TCP connex attempt to the Remnux VM
- open up a listener to it can connnec to Remnux
- nc -l -n -p 6667
	-Nick: (name)
	-User: (username string)
	-channel

now look at proc mon & - it now has established connex.
- release the netcat, and start the IRC server ircd start

- now we have happy packets
- FOLLOW TCP STREAM
- name=Mikey

Does malware change names?  (no, stopped restarted)
multiple instances? (click twice... wait 20/30 seconds... see what happens)
* Fdy joins chat
on FTP; let's follow the other stream (Fdy)
nick mikey | nickname is already in use | nick mikey | repeated... (maybe mikey is controller???)

6. What file is it looking for? (it was requesting a file C:\windows\System32\gus.ini)
- placed gus.ini in there (some base 64 bullcrap file)
- now run malware again...
- process explorer - PORT CHANGED (6667 is now 6666)
- follow newest TCP stream
- new channel (soup?)
- start IRC again

Key Indicators?
- run key (service profiler - registry key)
- gus.ini 
- irc - all of these domains and ports 6667
- hash of the file (the .exe)


============================================================================================================================
============================================================================================================================

1- hash (md5sum) hanuman.exe > malwarenotes.txt
2- is it packed?  (drag & drop --> PEid)
LCC is lightweight compiler, so no it's not packed; it's compiled.
3 - look at strings (drag & drop --> BinText)
Pull out relevant info
- domain
- hanuman server
- cmd.exe
- command.com
- listen/bind/socker error *indicative of opening ports*
- You are client No. :%lu *indicative of placeholder for variable*
- press okay to start server
4 - Setup tools to capture malware
-> Wireshark  (restart capture)
-> Process Explorer (processtree)  (real-time running processes)
-> Process Monitor 
	- only removed one pid? 
5 - run malware
5.1 Process Monitor (procmon) 
	- stop collecting
	- filter:  operation is createfile
	- filter:  processname is hanuman
- Did Hanuman create any files?
		- double click entries of second filter
		- OpenResult:  [no entries say "created"; so no files were created]
	- filter: Path contains .exe
	- *running from malware folder
5.2 Process Explorer (tabs)
	- right click hanuman, [image tab] look at path
	- TCP/IP - unclick resolve address *so you get the IP address*
	- appears to be listening on 3333
5.3 WireShark
- Did Hanuman create any network traffic?
	No. (no traffic in wireshark)
- Can we connect to Hanuman?
#> telnet 10.0.0.90 3333
run simple commands (systeminfo)
- follow TCP stream in Wireshark
- Process Explorer (tabs) - look at TCP/IP again (new connection established)

*** 6. kill process tree from within process explorer. ***

If you only kill Hanuman and not the process-tree.

============================================================================================================================
============================================================================================================================
1- hash
2- is it packed? (no, C++ = compiler)
3- strings
---------
dynamic analysis
---------
process monitor
process explorer
wireshark
Last-Thing! -capturebat > capturebatdocs.txt
- processexplorer TCP/IP tab








